{% extends 'base.html' %}

{% block content %}
<div class="container fade-in">
    <div class="text-center mb-5">
        <h1 class="display-3 fw-bold" style="color: var(--burgundy);">Empório Della Casa</h1>
        <p class="text-muted">Sua curadoria particular de vinhos premium.</p>
        <div style="height: 2px; width: 60px; background: var(--gold); margin: 20px auto;"></div>
    </div>

    <div class="row mb-5 justify-content-center text-center">
        <div class="col-12 mb-4">
            <h5 class="text-uppercase ls-2 fw-bold text-muted" style="font-size: 0.8rem;">Explore por Estilo</h5>
        </div>

        <div class="col-4 col-md-2 mb-3">
            <div class="filter-card p-3 shadow-sm glass-card">
                <i class="bi bi-funnel-fill fs-3 mb-2 d-block" style="color: var(--burgundy);"></i>
                <span class="small fw-bold">Tintos</span>
            </div>
        </div>
        <div class="col-4 col-md-2 mb-3">
            <div class="filter-card p-3 shadow-sm glass-card">
                <i class="bi bi-droplet fs-3 mb-2 d-block" style="color: var(--burgundy);"></i>
                <span class="small fw-bold">Brancos</span>
            </div>
        </div>
        <div class="col-4 col-md-2 mb-3">
            <div class="filter-card p-3 shadow-sm glass-card">
                <i class="bi bi-brightness-high fs-3 mb-2 d-block" style="color: var(--burgundy);"></i>
                <span class="small fw-bold">Rosés</span>
            </div>
        </div>
        <div class="col-4 col-md-2 mb-3">
            <div class="filter-card p-3 shadow-sm glass-card">
                <i class="bi bi-stars fs-3 mb-2 d-block" style="color: var(--burgundy);"></i>
                <span class="small fw-bold">Espumantes</span>
            </div>
        </div>
        <div class="col-4 col-md-2 mb-3">
            <div class="filter-card p-3 shadow-sm glass-card">
                <i class="bi bi-tag-fill fs-3 mb-2 d-block" style="color: var(--burgundy);"></i>
                <span class="small fw-bold">Ofertas</span>
            </div>
        </div>
    </div>

    <section class="mb-5">
        <div class="d-flex justify-content-between align-items-end mb-4 border-bottom pb-2">
            <h2 class="fw-bold mb-0" style="color: var(--burgundy); font-family: 'Playfair Display', serif;">Mais Vendidos</h2>
            <a href="#" class="text-decoration-none text-muted small">Ver todos <i class="bi bi-chevron-right"></i></a>
        </div>
        <div class="row">
            {% for product in products|slice:":4" %}
                {% include "products/includes/wine_card.html" %}
            {% endfor %}
        </div>
    </section>

    <div class="row mb-5 align-items-center bg-white rounded-5 shadow-sm p-4 mx-0 overflow-hidden border">
        <div class="col-md-6 p-4">
            <div class="badge bg-gold mb-3 text-dark fw-bold" style="background-color: var(--gold);">Winehunters</div>
            <h2 class="display-6 fw-bold mb-3">Vinhos do Velho e Novo Mundo</h2>
            <p class="text-muted">Nossa curadoria viaja pelas principais regiões vinícolas para trazer rótulos surpreendentes.</p>
            <button class="btn btn-burgundy px-4 mt-2 shadow-sm">Conhecer Curadoria</button>
        </div>
        <div class="col-md-6 text-center d-none d-md-block">
             <i class="bi bi-globe-americas display-1 opacity-25" style="color: var(--burgundy);"></i>
        </div>
    </div>

    <section>
        <div class="d-flex justify-content-between align-items-end mb-4">
            <h2 class="fw-bold mb-0" style="color: var(--burgundy); font-family: 'Playfair Display', serif;">Toda a Adega</h2>
        </div>
        <div class="row">
            {% for product in products %}
                {% include "products/includes/wine_card.html" %}
            {% endfor %}
        </div>
    </section>
</div>

<style>
    .ls-2 { letter-spacing: 2px; }
    .filter-card { border-radius: 20px; cursor: pointer; transition: 0.3s; }
    .filter-card:hover { transform: translateY(-5px); background: white !important; }
    .glass-card {
        background: rgba(255, 255, 255, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 25px;
        backdrop-filter: blur(10px);
        transition: all 0.4s ease;
    }
    .glass-card:hover { transform: translateY(-10px); background: rgba(255, 255, 255, 0.8); }
</style>

<script>
// AJAX Adicionar ao carrinho
document.addEventListener('click', function(e) {
    if (e.target.closest('.add-to-cart')) {
        e.preventDefault();
        const btn = e.target.closest('.add-to-cart');
        const productId = btn.dataset.id;
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';

        fetch(`/add/${productId}/`)
            .then(response => response.json())
            .then(data => {
                const badge = document.getElementById('cart-badge');
                if (badge) { badge.innerText = data.cart_count; badge.classList.remove('d-none'); }
                btn.classList.replace('btn-burgundy', 'btn-success');
                btn.innerHTML = '✅ Adicionado';
                setTimeout(() => {
                    btn.classList.replace('btn-success', 'btn-burgundy');
                    btn.innerHTML = '<i class="bi bi-cart-plus me-1"></i> Adicionar';
                    btn.disabled = false;
                }, 2000);
            });
    }
});
</script>
{% endblock %}